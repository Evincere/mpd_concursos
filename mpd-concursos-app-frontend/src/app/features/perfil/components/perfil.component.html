<div class="perfil-container">
    <header class="perfil-header">
        <h2>
            <i class="fas fa-user-circle"></i>
            Mi Perfil
        </h2>
    </header>

    <mat-tab-group class="perfil-tabs">
        <!-- Tab Información Personal -->
        <mat-tab label="Información Personal">
            <div class="tab-content">
                <div class="perfil-foto">
                    <div class="foto-container">
                        <ng-container
                            *ngIf="fotoPerfil && fotoPerfil !== 'assets/images/default-avatar.png'; else defaultAvatar">
                            <img [src]="fotoPerfil" alt="Foto de perfil">
                        </ng-container>
                        <ng-template #defaultAvatar>
                            <div class="default-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                        </ng-template>
                        <button mat-mini-fab class="cambiar-foto-btn" (click)="abrirSelectorArchivo()">
                            <i class="fas fa-camera"></i>
                        </button>
                        <input type="file" hidden #fileInput (change)="onFileSelected($event)" accept="image/*">
                    </div>
                </div>

                <form [formGroup]="perfilForm" class="perfil-form">
                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-user"></i>
                            <h3>Datos Personales</h3>
                        </div>
                        <div class="form-grid">
                            <mat-form-field>
                                <input matInput formControlName="nombre" required>
                                <mat-label>
                                    <span *ngFor="let item of splitLabel('Nombre')"
                                        [style.transition-delay]="item.delay">
                                        {{item.char}}
                                    </span>
                                </mat-label>
                                <mat-error *ngIf="perfilForm.get('nombre')?.hasError('required')">
                                    El nombre es requerido
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field>
                                <input matInput formControlName="apellido" required>
                                <mat-label>
                                    <span *ngFor="let item of splitLabel('Apellido')"
                                        [style.transition-delay]="item.delay">
                                        {{item.char}}
                                    </span>
                                </mat-label>
                                <mat-error *ngIf="perfilForm.get('apellido')?.hasError('required')">
                                    El apellido es requerido
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field>
                                <input matInput formControlName="cuit" required>
                                <mat-label>
                                    <span *ngFor="let item of splitLabel('CUIT')" [style.transition-delay]="item.delay">
                                        {{item.char}}
                                    </span>
                                </mat-label>
                                <mat-error *ngIf="perfilForm.get('cuit')?.hasError('required')">
                                    El CUIT es requerido
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field>
                                <input matInput formControlName="usuario" required>
                                <mat-label>
                                    <span *ngFor="let item of splitLabel('Usuario')"
                                        [style.transition-delay]="item.delay">
                                        {{item.char}}
                                    </span>
                                </mat-label>
                                <mat-error *ngIf="perfilForm.get('usuario')?.hasError('required')">
                                    El usuario es requerido
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="section-header">
                            <i class="fas fa-address-card"></i>
                            <h3>Información de Contacto</h3>
                        </div>
                        <div class="form-grid">
                            <mat-form-field>
                                <input matInput formControlName="email" type="email" required>
                                <mat-label>
                                    <span *ngFor="let item of splitLabel('Email')"
                                        [style.transition-delay]="item.delay">
                                        {{item.char}}
                                    </span>
                                </mat-label>
                                <mat-error *ngIf="perfilForm.get('email')?.hasError('required')">
                                    El email es requerido
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field>
                                <input matInput formControlName="telefono" required>
                                <mat-label>
                                    <span *ngFor="let item of splitLabel('Teléfono')"
                                        [style.transition-delay]="item.delay">
                                        {{item.char}}
                                    </span>
                                </mat-label>
                                <mat-error *ngIf="perfilForm.get('telefono')?.hasError('required')">
                                    El teléfono es requerido
                                </mat-error>
                            </mat-form-field>

                            <mat-form-field class="full-width">
                                <input matInput formControlName="direccion" required>
                                <mat-label>
                                    <span *ngFor="let item of splitLabel('Dirección')"
                                        [style.transition-delay]="item.delay">
                                        {{item.char}}
                                    </span>
                                </mat-label>
                                <mat-error *ngIf="perfilForm.get('direccion')?.hasError('required')">
                                    La dirección es requerida
                                </mat-error>
                            </mat-form-field>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button mat-stroked-button type="button" class="action-button"
                            [ngClass]="{'accent-button': true}" (click)="resetForm()">
                            <i class="fas fa-undo"></i>
                            Restaurar
                        </button>
                        <button mat-flat-button type="button" class="action-button" [ngClass]="{'primary-button': true}"
                            [disabled]="!perfilForm.valid || !perfilForm.dirty" (click)="guardarPerfil()">
                            <i class="fas fa-save"></i>
                            Guardar Cambios
                        </button>
                    </div>
                </form>
            </div>
        </mat-tab>

        <!-- Tab Redes Sociales -->
        <mat-tab label="Redes Sociales">
            <div class="tab-content">
                <div class="social-card">
                    <div class="social-header">
                        <i class="fab fa-linkedin"></i>
                        <h3>LinkedIn</h3>
                    </div>
                    <p>Conecta tu cuenta de LinkedIn para compartir tus logros y actividades</p>
                    <button mat-raised-button [color]="linkedInConectado ? 'warn' : 'primary'"
                        (click)="conectarLinkedIn()">
                        {{ linkedInConectado ? 'Desconectar' : 'Conectar' }}
                    </button>
                </div>
            </div>
        </mat-tab>

        <!-- Tab Currículum -->
        <mat-tab label="Currículum">
            <div class="curriculum-container">
                <!-- Barra lateral con botones de acción -->
                <aside class="curriculum-sidebar">
                    <div class="action-group">
                        <h3>Experiencia Laboral</h3>
                        <button mat-flat-button color="primary" (click)="agregarExperiencia()">
                            <i class="fas fa-plus"></i>
                            Agregar Experiencia
                        </button>
                    </div>
                    <div class="action-group">
                        <h3>Educación</h3>
                        <button mat-flat-button color="primary" (click)="agregarEducacion()">
                            <i class="fas fa-plus"></i>
                            Agregar Educación
                        </button>
                    </div>
                </aside>

                <!-- Contenido principal del currículum -->
                <main class="curriculum-content" [formGroup]="perfilForm">
                    <!-- Sección de Experiencia Laboral -->
                    <section class="cv-section">
                        <div class="section-header">
                            <i class="fas fa-briefcase"></i>
                            <h2>Experiencia Laboral</h2>
                        </div>

                        <div class="cv-items" formArrayName="experiencias">
                            <div class="cv-item" *ngFor="let exp of experiencias.controls; let i = index"
                                [formGroupName]="i">
                                <div class="item-main">
                                    <div class="item-header">
                                        <mat-form-field appearance="outline">
                                            <mat-label>Cargo o Puesto</mat-label>
                                            <input matInput formControlName="puesto">
                                        </mat-form-field>
                                    </div>

                                    <mat-form-field appearance="outline">
                                        <mat-label>Empresa u Organización</mat-label>
                                        <input matInput formControlName="empresa">
                                    </mat-form-field>

                                    <div class="form-row">
                                        <!-- Campo de fecha de inicio -->
                                        <div class="form-field-container">
                                            <label for="fechaInicio" class="form-label">Fecha de Inicio</label>
                                            <div class="input-group">
                                                <input id="fechaInicio" 
                                                    type="text" 
                                                    class="form-control" 
                                                    #dp="bsDatepicker"
                                                    [bsConfig]="bsConfig" 
                                                    bsDatepicker 
                                                    [formControl]="fechaInicioControl"
                                                    [attr.aria-label]="'Seleccionar fecha de inicio'" 
                                                    placement="bottom">
                                                <button class="btn btn-outline-secondary calendar-btn" (click)="dp.toggle()"
                                                    [attr.aria-label]="'Abrir calendario'">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Campo de fecha de fin -->
                                        <div class="form-field-container">
                                            <label for="fechaFin" class="form-label">Fecha de Fin</label>
                                            <div class="input-group">
                                                <input id="fechaFin" 
                                                    type="text" 
                                                    class="form-control" 
                                                    #dpFin="bsDatepicker"
                                                    [bsConfig]="bsConfig" 
                                                    bsDatepicker 
                                                    [formControl]="fechaFinControl"
                                                    [attr.aria-label]="'Seleccionar fecha de fin'" 
                                                    placement="bottom">
                                                <button class="btn btn-outline-secondary calendar-btn" (click)="dpFin.toggle()"
                                                    [attr.aria-label]="'Abrir calendario'">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <mat-form-field appearance="outline" class="description-field">
                                        <mat-label>Descripción de responsabilidades y logros</mat-label>
                                        <textarea matInput formControlName="descripcion" rows="3"></textarea>
                                    </mat-form-field>
                                </div>

                                <div class="item-actions">
                                    <button mat-icon-button color="warn" (click)="eliminarExperiencia(i)"
                                        class="delete-button">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Sección de Educación -->
                    <section class="cv-section">
                        <div class="section-header">
                            <i class="fas fa-graduation-cap"></i>
                            <h2>Educación</h2>
                        </div>

                        <div class="cv-items" formArrayName="educacion">
                            <div class="cv-item" *ngFor="let edu of educacion.controls; let i = index"
                                [formGroupName]="i">
                                <div class="item-main">
                                    <div class="item-header">
                                        <mat-form-field appearance="outline">
                                            <mat-label>Título o Certificación</mat-label>
                                            <input matInput formControlName="titulo">
                                        </mat-form-field>
                                    </div>

                                    <mat-form-field appearance="outline">
                                        <mat-label>Institución</mat-label>
                                        <input matInput formControlName="institucion">
                                    </mat-form-field>

                                    <div class="form-row">
                                        <!-- Campo de fecha de inicio educación -->
                                        <div class="form-field-container">
                                            <label for="fechaEduInicio" class="form-label">Fecha de Inicio</label>
                                            <div class="input-group">
                                                <input id="fechaEduInicio" 
                                                    type="text" 
                                                    class="form-control" 
                                                    #dpEduInicio="bsDatepicker"
                                                    [bsConfig]="bsConfig" 
                                                    bsDatepicker 
                                                    [formControl]="fechaEduInicioControl"
                                                    [attr.aria-label]="'Seleccionar fecha de inicio de educación'" 
                                                    placement="bottom">
                                                <button class="btn btn-outline-secondary calendar-btn" (click)="dpEduInicio.toggle()"
                                                    [attr.aria-label]="'Abrir calendario'">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Campo de fecha de fin educación -->
                                        <div class="form-field-container">
                                            <label for="fechaEduFin" class="form-label">Fecha de Fin</label>
                                            <div class="input-group">
                                                <input id="fechaEduFin" 
                                                    type="text" 
                                                    class="form-control" 
                                                    #dpEduFin="bsDatepicker"
                                                    [bsConfig]="bsConfig" 
                                                    bsDatepicker 
                                                    [formControl]="fechaEduFinControl"
                                                    [attr.aria-label]="'Seleccionar fecha de fin de educación'" 
                                                    placement="bottom">
                                                <button class="btn btn-outline-secondary calendar-btn" (click)="dpEduFin.toggle()"
                                                    [attr.aria-label]="'Abrir calendario'">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="item-actions">
                                    <button mat-icon-button color="warn" (click)="eliminarEducacion(i)"
                                        class="delete-button">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>
                </main>
            </div>
        </mat-tab>
    </mat-tab-group>
</div>